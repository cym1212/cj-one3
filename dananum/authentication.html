<div id="dn-gallery" class="dn-container">
  <div class="dn-grid">
    <!-- 썸네일 a 태그: href는 원본(s0), data-index로 순서 표시 -->
    <a class="dn-item" href="https://lh3.googleusercontent.com/OGLlM2UFKN0CbcVD1VjSyDmGBwTgf05sUqBsoQlLlMrwiXzTtokYB_1ztwdCQJmYV2wgTuicUTLwrM65HQ1XjT6iHJaCcvgAR29D0hSiUdJ9kn7u98jp=s0" data-index="0">
      <img src="https://lh3.googleusercontent.com/OGLlM2UFKN0CbcVD1VjSyDmGBwTgf05sUqBsoQlLlMrwiXzTtokYB_1ztwdCQJmYV2wgTuicUTLwrM65HQ1XjT6iHJaCcvgAR29D0hSiUdJ9kn7u98jp=w800" alt="001">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/KHTk43MwxoarbH2IJv_SfRiH31jFk8nN7VwM8H693eh_Ke-0BD_G4QRHpqgetZseqdb3R6hxUNenBosJWQlwLMbOOxOrtqctjylhR0QWzz4elt3ZAPF_ZNY=s0" data-index="1">
      <img src="https://lh3.googleusercontent.com/KHTk43MwxoarbH2IJv_SfRiH31jFk8nN7VwM8H693eh_Ke-0BD_G4QRHpqgetZseqdb3R6hxUNenBosJWQlwLMbOOxOrtqctjylhR0QWzz4elt3ZAPF_ZNY=w800" alt="004">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/SYqTV-Us9QqOd3O-5Yge_lj33DCpTcc1BPtxEuB5Rb1Jot3m9F3WGgiixvBNZa2G7dDFKt-nUpUYkdGmMtR2i12rOY0ats9L8EZZE89RP4-8OClv9Korj8U=s0" data-index="2">
      <img src="https://lh3.googleusercontent.com/SYqTV-Us9QqOd3O-5Yge_lj33DCpTcc1BPtxEuB5Rb1Jot3m9F3WGgiixvBNZa2G7dDFKt-nUpUYkdGmMtR2i12rOY0ats9L8EZZE89RP4-8OClv9Korj8U=w800" alt="002">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/pNbg1N8tBLMUFKemci0S-z-3wijooHe7iW0k0dB0uCgn3MGNsonyI1PanjVwMx1TmbNFQMBjKC5UvYH8ZyVhAUHfGWCY31fJNBRS7qdnLJ9Yq7WSO936=s0" data-index="3">
      <img src="https://lh3.googleusercontent.com/pNbg1N8tBLMUFKemci0S-z-3wijooHe7iW0k0dB0uCgn3MGNsonyI1PanjVwMx1TmbNFQMBjKC5UvYH8ZyVhAUHfGWCY31fJNBRS7qdnLJ9Yq7WSO936=w800" alt="006">
    </a>

    <a class="dn-item" href="https://withcookie.b-cdn.net/c/default/0.31538742634825456.jpg" data-index="4">
      <img src="https://withcookie.b-cdn.net/c/default/0.31538742634825456.jpg" alt="003">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/xM339l5y1k4MSrm3hw1N5A94uJAwyXu35_0FXypAVPuQ-FXwJHJJYA0MyCjIWmCK68HFiqoiRuzAedg3RIKktaEp5l92OzwhBQXvZrSO4cA6g6-ODKiHpg=s0" data-index="5">
      <img src="https://lh3.googleusercontent.com/xM339l5y1k4MSrm3hw1N5A94uJAwyXu35_0FXypAVPuQ-FXwJHJJYA0MyCjIWmCK68HFiqoiRuzAedg3RIKktaEp5l92OzwhBQXvZrSO4cA6g6-ODKiHpg=w800" alt="005">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/YDpEZNYJvUuu5edPlUvKDS4tVjEllrgDxqsUgnVh7bFzZGgDxGmNPA8pchKLSzuH147px2jnaQLMzAjZX1EaOpK6qeR0_xo0VLHwrO5wd0g3tXMXuOra=s0" data-index="6">
      <img src="https://lh3.googleusercontent.com/YDpEZNYJvUuu5edPlUvKDS4tVjEllrgDxqsUgnVh7bFzZGgDxGmNPA8pchKLSzuH147px2jnaQLMzAjZX1EaOpK6qeR0_xo0VLHwrO5wd0g3tXMXuOra=w800" alt="007">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/JFRiJo3b0RcVegA6KG10Y7JtUqR3sisX7XxIpWwH9i2groHPKXTXKXqHPEVQwrC8xIc0VSgjMcHXAhcr4ND8U9zXkSTIbqKtlbSD1MiN0rNPNsokiMCwwQ=s0" data-index="7">
      <img src="https://lh3.googleusercontent.com/JFRiJo3b0RcVegA6KG10Y7JtUqR3sisX7XxIpWwH9i2groHPKXTXKXqHPEVQwrC8xIc0VSgjMcHXAhcr4ND8U9zXkSTIbqKtlbSD1MiN0rNPNsokiMCwwQ=w800" alt="008">
    </a>

    <a class="dn-item" href="https://lh3.googleusercontent.com/XxUSNpU_8y3JrNlbF0vmnmuUcmMEwNu5DeX6Ms-OIL_2iVZgTMbEaBtEyJEiiVgp99I8jVPUumGHNePXNgMWx0UroZXUXo_EXBxL1vK7_7KEwcV9typt59Q=s0" data-index="8">
      <img src="https://lh3.googleusercontent.com/XxUSNpU_8y3JrNlbF0vmnmuUcmMEwNu5DeX6Ms-OIL_2iVZgTMbEaBtEyJEiiVgp99I8jVPUumGHNePXNgMWx0UroZXUXo_EXBxL1vK7_7KEwcV9typt59Q=w800" alt="009">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/TuXuG3fD5vL8ND9sHjC4FgSpvFQSBWkZnbFM3Si8rGsvIjDwWp2ZV-1RN6PdqqLqIjieHz0Qtm7CtzmXskLP2IBTpggc3Cc9TXuUmm-H-3EoWLxybnA1jIM=s0" data-index="9">
      <img src="https://lh3.googleusercontent.com/TuXuG3fD5vL8ND9sHjC4FgSpvFQSBWkZnbFM3Si8rGsvIjDwWp2ZV-1RN6PdqqLqIjieHz0Qtm7CtzmXskLP2IBTpggc3Cc9TXuUmm-H-3EoWLxybnA1jIM=w800" alt="010">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/fIVi9yne2kW8rhChzGYYhN2gAwRN2h0NdwKflWsW8HdyWQ1fnM8StZJD1bnKVu6tdpyL5_-PtXkaxzjT1TmdLvuH5WVyNUVFfS-LLwnltOW9Xtcn-uwZN1U=s0" data-index="10">
      <img src="https://lh3.googleusercontent.com/fIVi9yne2kW8rhChzGYYhN2gAwRN2h0NdwKflWsW8HdyWQ1fnM8StZJD1bnKVu6tdpyL5_-PtXkaxzjT1TmdLvuH5WVyNUVFfS-LLwnltOW9Xtcn-uwZN1U=w800" alt="011">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/lDC1ikUUig6OuivaEa6yxa2Q_2i3JhP80VgyJqghI_p9IxgPhLmx540HX9OWFjyxgfjOOHB9QGwQRzGEpJoJigyASDXoQl3UqQy8IIEHZoy9G8x9Ccct1A=s0" data-index="11">
      <img src="https://lh3.googleusercontent.com/lDC1ikUUig6OuivaEa6yxa2Q_2i3JhP80VgyJqghI_p9IxgPhLmx540HX9OWFjyxgfjOOHB9QGwQRzGEpJoJigyASDXoQl3UqQy8IIEHZoy9G8x9Ccct1A=w800" alt="013">
    </a>

    <a class="dn-item" href="https://lh3.googleusercontent.com/N4YwdVmTERumCusy3SGIPAsbal_A2iNjdS5Nh2hXCfonqTmCUvvEL7_RVr8RVsd-5Wf2BezjL1-Tm7bUyf2SWySd0kYwSakl-rwzloKbpBnNsMVPfYHaow=s0" data-index="12">
      <img src="https://lh3.googleusercontent.com/N4YwdVmTERumCusy3SGIPAsbal_A2iNjdS5Nh2hXCfonqTmCUvvEL7_RVr8RVsd-5Wf2BezjL1-Tm7bUyf2SWySd0kYwSakl-rwzloKbpBnNsMVPfYHaow=w800" alt="012">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/TXuzbW3VCJT4xZNbYwYZfjywF-bZN1_B1qteQzcOyvQfAxnIIkmwXCGQJUtHpkirlXxi35A_OF3IAexqPSDBFymm_nX583x-E7Ex0E2GF1F8G8zdMazb=s0" data-index="13">
      <img src="https://lh3.googleusercontent.com/TXuzbW3VCJT4xZNbYwYZfjywF-bZN1_B1qteQzcOyvQfAxnIIkmwXCGQJUtHpkirlXxi35A_OF3IAexqPSDBFymm_nX583x-E7Ex0E2GF1F8G8zdMazb=w800" alt="015">
    </a>
    <a class="dn-item" href="https://lh3.googleusercontent.com/J8Cm8Ulq7aPcq7_28qcH6CmsJD19730v2g8bWdfJ0zf0dv5cNM57OXxM2iUgD1O-TdtTtCcF4ubJIPjmjO3A_hhu3wAqK0adskii9gJ7uYNsER-EIQID=s0" data-index="14">
      <img src="https://lh3.googleusercontent.com/J8Cm8Ulq7aPcq7_28qcH6CmsJD19730v2g8bWdfJ0zf0dv5cNM57OXxM2iUgD1O-TdtTtCcF4ubJIPjmjO3A_hhu3wAqK0adskii9gJ7uYNsER-EIQID=w800" alt="014">
    </a>
  </div>
</div>
<script>
  (function(){
    // 랜덤 프리픽스
    function randPrefix(n){var s='',c='abcdefghijklmnopqrstuvwxyz';for(var i=0;i<n;i++)s+=c[Math.floor(Math.random()*c.length)];return s;}
    var root = document.getElementById('dn-gallery');
    if(!root) return;

    // ✅ 중복 초기화 가드
    if (root.dataset.dnInit === '1') return;
    root.dataset.dnInit = '1';

    var px = randPrefix(5);
    root.classList.add(px + '-scope');

    // 안전 vh 변수
    function setSafeVH(){
      var vh=(window.visualViewport?window.visualViewport.height:window.innerHeight)*0.01;
      document.documentElement.style.setProperty('--vh', vh+'px');
    }
    setSafeVH();
    window.addEventListener('resize', setSafeVH);
    if (window.visualViewport) window.visualViewport.addEventListener('resize', setSafeVH);

    // ✅ 고유 ID로 모달 생성(이미 있으면 재생성 안 함)
    var modalId = 'dnModal-' + px;
    if (!document.getElementById(modalId)) {
      document.body.insertAdjacentHTML('afterbegin', `
      <div class="dn-modal ${px}-scope" id="${modalId}" aria-hidden="true" style="display:none;">
        <a href="#" class="dn-close" id="dnClose-${px}" aria-label="닫기">&times;</a>
        <span class="dn-count" id="dnCount-${px}">1 / 0</span>
        <a href="#" class="dn-prev" id="dnPrev-${px}" aria-label="이전">&#10094;</a>
        <img id="dnModalImg-${px}" src="" alt="">
        <a href="#" class="dn-next" id="dnNext-${px}" aria-label="다음">&#10095;</a>
      </div>
    `);
    }

    // 엘리먼트 참조(고유 ID 사용)
    var modal   = document.getElementById(modalId);
    var img     = document.getElementById('dnModalImg-' + px);
    var count   = document.getElementById('dnCount-' + px);
    var btnPrev = document.getElementById('dnPrev-'  + px);
    var btnNext = document.getElementById('dnNext-'  + px);
    var btnClose= document.getElementById('dnClose-' + px);

    // 스타일(원래 쓰던 CSS 그대로 사용 가능)
    var css = `
#dn-gallery.${px}-scope, #dn-gallery.${px}-scope * { box-sizing:border-box; }
#dn-gallery.${px}-scope { max-width:1200px; margin:0 auto; padding:12px; width:100%; }
#dn-gallery.${px}-scope .dn-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; }
@media (max-width:820px){ #dn-gallery.${px}-scope .dn-grid { grid-template-columns:1fr; } }
#dn-gallery.${px}-scope.${px}-force-1col .dn-grid { grid-template-columns:1fr !important; }
#dn-gallery.${px}-scope .dn-item img { width:100%; height:auto; display:block; border-radius:6px; cursor:pointer; }

#${modalId}.${px}-scope{
  position:fixed !important; inset:0 !important; width:100% !important;
  height:100dvh; height:100svh; height:calc(var(--vh,1vh)*100);
  display:none; justify-content:center; align-items:center;
  background:rgba(0,0,0,.9); z-index:2147483647 !important; padding:20px; overflow:hidden !important;
}
#${modalId}.${px}-scope.is-open{ display:flex !important; }
#dnModalImg-${px}{ max-width:min(90vw,1200px); max-height:80dvh; max-height:80svh; max-height:calc(var(--vh,1vh)*80); object-fit:contain; border-radius:4px; box-shadow:0 8px 24px rgba(0,0,0,.5); pointer-events:none; }
#${modalId}.${px}-scope .dn-close,#${modalId}.${px}-scope .dn-prev,#${modalId}.${px}-scope .dn-next,#${modalId}.${px}-scope .dn-count{ position:absolute; color:#fff; font-weight:700; text-decoration:none; user-select:none; }
#dnClose-${px}{ top:20px; right:28px; font-size:38px; line-height:1; }
#dnCount-${px}{ top:20px; left:20px; background:rgba(0,0,0,.5); padding:6px 10px; border-radius:4px; font-size:14px; }
#dnPrev-${px},#dnNext-${px}{ top:50%; transform:translateY(-50%); font-size:28px; background:rgba(0,0,0,.5); padding:14px 16px; border-radius:6px; line-height:1; }
#dnPrev-${px}{ left:12px; } #dnNext-${px}{ right:12px; }
body.${px}-lock{ position:fixed !important; width:100% !important; overflow:hidden !important; inset:0 0 auto 0; }
  `;
    var style=document.createElement('style'); style.type='text/css'; style.appendChild(document.createTextNode(css)); document.head.appendChild(style);

    // 모바일 UA면 1열 강제
    if (/Android|iPhone|iPad|iPod|Mobile|IEMobile|BlackBerry|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)){
      root.classList.add(px + '-force-1col');
    }

    // 라이트박스 로직
    const thumbs = Array.from(root.querySelectorAll('.dn-item'));
    const originals = thumbs.map(a => a.getAttribute('href'));
    let idx=0, scrollTop=0;

    function updateModal(){
      img.src = originals[idx];
      count.textContent = (idx+1)+' / '+originals.length;
    }
    function openModal(i){
      idx=i; updateModal();
      scrollTop = window.pageYOffset || document.documentElement.scrollTop || 0;
      document.body.classList.add(px+'-lock');
      document.body.style.top = `-${scrollTop}px`;
      modal.classList.add('is-open'); modal.setAttribute('aria-hidden','false');
      setTimeout(function(){ btnClose && btnClose.focus(); }, 80);
    }
    function closeModal(){
      modal.classList.remove('is-open'); modal.setAttribute('aria-hidden','true');
      document.body.classList.remove(px+'-lock');
      document.body.style.top = ''; window.scrollTo(0, scrollTop);
      img.src='';
    }
    function prev(){ idx=(idx-1+originals.length)%originals.length; updateModal(); }
    function next(){ idx=(idx+1)%originals.length; updateModal(); }

    // 썸네일 클릭(중복 바인딩 방지용 once 옵션)
    thumbs.forEach(a=>{
      a.addEventListener('click', function(e){
        e.preventDefault();
        const i=parseInt(a.getAttribute('data-index'),10)||0;
        openModal(i);
      }, {passive:false, once:false});
    });

    // 닫기/이전/다음
    btnClose.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); closeModal(); }, {once:false});
    btnPrev .addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); prev(); }, {once:false});
    btnNext .addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); next(); }, {once:false});

    // 바깥 클릭 닫기
    modal.addEventListener('click', function(e){
      if (e.target === modal) closeModal();
    });

    // 키보드
    document.addEventListener('keydown', function(e){
      if (!modal.classList.contains('is-open')) return;
      if (e.key==='Escape') closeModal();
      else if (e.key==='ArrowLeft') prev();
      else if (e.key==='ArrowRight') next();
    });

    // iOS 스크롤 방지
    window.addEventListener('touchmove', function(e){
      if (modal.classList.contains('is-open')) e.preventDefault();
    }, {passive:false});
  })();
</script>